---
name: scenario-bugfix-root-cause
description: Bug 修复流程：复现 → 根因定位 → 修复 → 回归测试 → 验证记录，强调先红后绿与风险登记。
---

# Bug 根因分析技能

## 适用场景
- 接收到 Bug 报告，需要系统地定位和修复。
- 要求提供复现证据、根因说明、回归测试、验证记录。
- 需评估影响面与回滚策略，确保交付闭环。

## 前置准备
- 收集完整上下文：日志、请求、版本、环境、时间线。
- 搭建复现环境（本地/预发），准备必要脚本或数据。
- 明确优先级与业务影响，是否需要停机或限流。

## 操作步骤
1. **复现问题**
   - 编写或执行最小复现脚本（curl、单测、E2E）。
   - 如果无法立即复现，记录尝试路径与差异。
2. **定位根因**
   - 使用日志、调试器、性能分析工具查找异常点。
   - 结合 git blame/历史提交理解原设计意图。
   - 输出根因陈述：触发条件、缺陷代码、为何未被捕捉。
3. **制定修复方案**
   - 先写失败测试（单元/集成），确认问题存在。
   - 设计最小修复，遵循 KISS/DRY/YAGNI，避免附带重构。
4. **实施与验证**
   - 修复后运行失败测试，确保转为通过。
   - 执行质量门（参见 `scenario-quality-gates`），记录命令与结果。
5. **风险与回滚**
   - 评估影响面、依赖模块、数据风险。
   - 设计回滚方案（代码 revert、数据脚本、开关控制）。
6. **交接与记录**
   - 编写修复说明：根因、修复点、验证、回滚。
   - 更新知识库或技能，防止同类问题复发。

## 质量校验
- 复现脚本或失败测试必须存在。
- 质量门全部通过，覆盖新增/受影响模块。
- 验证记录可复核：命令输出、测试日志、监控截图。

## 失败与回滚
- 无法在限定时间内复现：升级为事故处理，拉齐干系人。
- 修复后测试仍失败：重新分析根因，避免盲目修改。
- 上线后回归：立即执行回滚策略，保留日志做复盘。

## 交付物
- Bug 修复报告：复现方法、根因、修复摘要。
- 回归测试列表与质量门执行记录。
- 回滚方案与后续监控/改进事项。
