---
name: scenario-feature-design
description: 当需要设计新功能并编写 FRD/技术方案，贯通商业价值、验收标准及双轨交付物时，请加载本技能。
allowed-tools: Read(*), Write(*), Edit(*), MultiEdit(*), Bash(*), Glob(*), Grep(*), TodoWrite
---

# 功能设计技能 (FRD)

## 适用场景

- 规划新特性或重大变更，需要形成完整的 FRD 与技术方案。
- 对齐业务目标、边界、验收标准、风险与回滚。
- 在进入实现前完成阶段性审批与质量预检。

## 前置准备

- 已完成 `method/business-impact-engineering` 输出，掌握商业目标、指标链路与灰度策略。
- 收集现有系统架构、数据模型、接口契约、权限模型，准备对照差异。
- 明确干系人名单（业务方、产品、架构、运维、安全），预约评审节奏与审批要求。
- 准备双轨交付模版：Mermaid 画布、表格模板、版本记录（可在 `templates/` 中维护）。

## FRD 模板与核心章节

1. **背景与目标**: 引用 `method-business-impact-engineering` 的输出，包括 Value Brief、指标链路、商业影响。
2. **需求范围与边界**: 包含用户故事、功能列表和“非目标”清单。
3. **数据结构与契约**: 定义核心实体、接口协议、状态机。
4. **架构决策与影响**: 描述技术选型、数据流、依赖关系、回滚策略。
5. **任务分解**: 拆分可执行任务，标注依赖、风险、Owner 和质量门。
6. **质量验收标准**: 定义功能/非功能（性能、安全）指标与监控需求。
7. **验证报告**: (后续阶段填写) 记录质量门执行结果。

## 操作步骤

1. **商业价值对齐 (前置)**
    - 必须先调用 `method-business-impact-engineering`，完成 Value Brief、指标链路、RICE/WSJF 评分、MVP 与灰度策略。
2. **目标与范围定义**
    - 将 Value Brief 的结论写入“背景与目标”章节。
    - 明确业务问题、KPI、功能范围与非功能需求，列出“不做”清单。
3. **双轨输岀 (图表 + 表格)**
    - **流程图**: 使用 Mermaid 绘制流程图、状态机或架构图，确保图表与表格内容一致。
    - **结构化表**: 使用表格定义需求范围、权限矩阵、接口清单等。
4. **技术方案与风险**
    - 描述架构、数据流、接口契约、数据模型。
    - 应用 `method/risk-matrix` 识别风险，制定缓解措施。
    - 设计回滚策略、特性开关、灰度方案。
5. **计划与验收**
    - 使用 `scenario/ratecard-quote` 估算成本，制定里程碑。
    - 定义详细的验收标准和测试策略。

## 质量校验

- FRD 章节齐全，与模板一致。
- Mermaid 图表渲染通过，且与表格内容一致。
- 技术方案符合 `CLAUDE.md` 红线（如无 N+1、可回滚）。
- 权限矩阵、风险列表、验收标准完整并获得评审通过。

## 失败与回滚

- 需求变更: 更新文档版本，记录变更原因与影响。
- 评审未通过: 收集反馈，补充数据或重新设计。
- 技术风险过高: 调整方案或拆分阶段，保留备选方案记录。

## 交付物

- 完整的 FRD 文档（Markdown + Mermaid 源文件）。
- 技术方案、权限矩阵、风险清单。
- 实施计划、里程碑、估算与验证策略。
