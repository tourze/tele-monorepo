## 特性开关与灰度放量模板

| 阶段 | 目标用户/分群 | 放量比例 | 观察时间/条件 | 主要指标 | 护栏阈值 | 触发动作 |
| ---- | -------------- | -------- | ------------- | -------- | -------- | -------- |
| Stage 0 | 内部员工 | 0%（黑暗发布） | 日志完成 + 无致命错误 | 健康检查 | Fatal=0 | 进入 Stage 1 |
| Stage 1 | 真实用户随机样本 | 1% | ≥30 分钟且 ≥N 次关键事件 | OEC、单位成本 | 错误率 > 基线×1.5 或 延迟 > +10% | 自动回滚 |
| Stage 2 | 关键市场 A | 10% | ≥2 小时且 ≥M 次关键事件 | OEC、护栏、成本 | 客服工单 ↑>20% | 冻结并排查 |
| Stage 3 | 全量但可熔断 | 25% | ≥6 小时或达到显著性 | OEC、SLO、成本 | SLO 预算耗尽 | 触发 Kill Switch |
| Stage 4 | 全量 | 50% | ≥1 天 | 指标稳定、无护栏触发 | 任一护栏触发 | 回滚至 Stage 2 |
| Stage 5 | 全量 | 100% | 迭代末 | 指标达成、误差预算 | - | 关闭开关、归档实验 |

> Kill Switch：`feature.toggle("checkout.revamp").disable()`；日志记录执行人、时间、原因；同步通知 on-call、PM、数据团队。
