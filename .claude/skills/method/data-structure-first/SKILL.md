---
name: method-data-structure-first
description: 当需要以数据结构驱动设计与实现，遵循“数据大于代码”以消除特殊情况与复杂度时，请加载本技能。
allowed-tools: Read(*), Write(*), Edit(*), MultiEdit(*), Bash(*), Glob(*), Grep(*), TodoWrite
---

# 数据结构优先技能

## 适用场景

- 设计新功能、重构或排查复杂逻辑时。
- 需要通过数据建模减少分支、消除 if/else 特殊情况。
- 在评审中论证方案是否符合 KISS/DRY/YAGNI。

## 前置准备

- 收集业务实体、关系、生命周期、约束。
- 获取现有数据库/接口/事件模型。
- 准备绘图工具（Mermaid、ERD），或使用 Markdown 表格描述结构。

## 操作步骤

1. **Linus 五问**
   - 这是真问题吗？能更简单吗？是否引入不必要复杂性？
   - 定义数据结构前先确认目标与边界。
2. **绘制数据流与关系**
   - 用 Mermaid 描述实体、状态流、交互：

     ```mermaid
     flowchart TD
       A([输入]) --> B{校验}
       B -->|通过| C[写入数据结构]
       B -->|失败| D[返回错误]
     ```

   - 确保流程图节点与表格一致。
3. **设计数据结构**
   - 优先选择能够覆盖大部分场景的简洁结构。
   - 通过枚举/状态机/多态数据结构消除条件分支。
   - 定义字段类型、可选项、默认值，避免 `null` 漫游。
4. **验证与试算**
   - 使用示例数据推演全流程，找出边界情况。
   - 对特殊情况重新建模或拆分，避免在代码中写特殊判断。
5. **对照实现**
   - 评估现有代码是否匹配新结构，确定迁移步骤。
   - 在 PRD、技术方案中更新数据结构，作为评审依据。

## 质量校验

- 数据结构覆盖所有业务场景，无需额外 if/else。
- 流程图、表格、实现代码保持一致。
- 设计通过团队评审，符合 `CLAUDE.md` 的贫血模型与无循环依赖要求。

## 失败与回滚

- 新结构导致性能/复杂度上升：回滚到旧结构，重新评估。
- 架构与数据不一致：暂停开发，先同步文档与实现。
- 状态膨胀：考虑拆分实体或引入状态模式。

## 交付物

- 数据结构定义（表格、Mermaid、类型声明）。
- 特殊情况分析与消除策略。
- 实现计划与验证清单。
