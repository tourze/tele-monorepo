---
name: method-context-snapshot
description: 当需要提炼会话历史并生成结构化快照，输出标准化 XML 表达时，请加载本技能。
allowed-tools: Read(*), Write(*), Edit(*), MultiEdit(*), Bash(*), Glob(*), Grep(*), TodoWrite
---

# 会话快照技能

## 适用场景

- 需要压缩对话历史，保留后续协作所需的关键信息。
- 需要在长对话中提炼目标、决策、现状、阻塞与下一步计划。
- 需要在不中断执行的前提下同步记录当前节奏与计划。

## 前置准备

- 回放当前会话历史，定位初始目标、关键转折、已完成的动作。
- 收集待办、失败测试、阻塞问题、用户提供的结论或批准。
- 明确输出格式：固定的 `<session_snapshot>` XML 块（禁止额外文本）。

## 操作步骤

1. **时间线梳理**
   - 找到任务起点（首个命令/需求），按时间列出主要事件。
   - 标记状态转换（如进入/退出质量门、等待用户反馈）。
2. **目标与决策提炼**
   - 汇总用户最终目标或最近确认的阶段目标。
   - 提取已被接受的决策、方案选择、风险裁决。
3. **现状评估**
   - 描述最新进展：改动文件、已完成的质量门、仍在执行的步骤。
   - 保留关键证据（命令结果、提交 ID、测试状态）。
4. **阻塞识别**
   - 列出尚未解决的问题：失败测试、缺失信息、待审批事项。
   - 指定责任人或需要谁来解锁（如等待用户确认）。
5. **下一步计划**
   - 结合 `todo` 列表，列出后续具体动作（命令/分析/沟通）。
   - 确保计划可执行、与 `CLAUDE.md` 质量门对齐。
6. **格式化输出**
   - 严格按照命令要求生成 XML，维持缩进统一、无额外注释。
   - 每个节点保持一句话或项目列表，避免冗长段落。

## 质量校验

- XML 结构完整，无缺失节点或空标签。
- 目标、决策、现状、阻塞、计划五要素均被填充且相互对应。
- 内容客观、可复核，引用的事实可在会话历史中找到。
- 对阻塞项给出明确下一步或信息需求，避免模糊描述。

## 失败与回滚

- 历史不足以生成快照：说明原因并请求更多上下文。
- 信息矛盾：回溯对话核实后再填入，必要时标注“待确认”。
- 输出格式错误：立即修正 XML 结构并重新生成。

## 交付物

- 单个 `<session_snapshot>` 块，可直接粘贴到后续对话。
- （可选）辅助笔记或清单供后续任务引用。
