---
name: method-security-baseline
description: 当需要落实输入校验、输出转义、鉴权、配置管理等安全基线，并结合审计与测试时，请加载本技能。
allowed-tools: Read(*), Write(*), Edit(*), MultiEdit(*), Bash(*), Glob(*), Grep(*), TodoWrite
---

# 安全基线技能

## 适用场景

- 新功能设计或安全评审，需要检查安全控制。
- 发布前进行安全自检、渗透测试支持。
- 发现安全事件后梳理缺失的控制项。

## 前置准备

- 阅读 `CLAUDE.md` 安全与合规基线。
- 获取接口/页面列表、数据流、敏感字段。
- 准备安全测试工具（OWASP ZAP、npm audit、composer audit）。

## 操作步骤

1. **输入校验**
   - 后端使用 `zod`/`pydantic`/Bean Validation/自定义 DTO。
   - 校验类型、范围、格式、必填项，拒绝非法输入。
2. **输出转义**
   - 模板/前端默认转义，禁止拼接 HTML/SQL。
   - 输出到日志前脱敏敏感信息。
3. **鉴权与授权**
   - 实施最小权限：角色 × 操作矩阵。
   - 对关键接口执行双重校验（身份 + 资源所有权）。
4. **配置与密钥**
   - 所有密钥从环境或 Secret Manager 注入，禁止硬编码。
   - 使用权限最小化的配置文件，限制可读范围。
5. **依赖安全**
   - 定期运行 `npm audit`, `composer audit`, `pip-audit`.
   - 对高危 CVE 制定升级计划或临时修复。
6. **日志与监控**
   - 记录 traceId、用户 ID、关键参数；对敏感信息进行掩码。
   - 设置异常登录、权限滥用报警。
7. **安全测试**
   - 编写安全用例：SQLi、XSS、CSRF、权限绕过。
   - 执行 SAST/DAST，结合质量门输出报告。

## 质量校验

- 安全自检清单通过，无未处理高危风险。
- 依赖扫描无高危漏洞或已有缓解计划。
- 安全测试记录（脚本、截图）可复核。

## 失败与回滚

- 发现高危风险：立即阻断发布，制定 Hotfix。
- 依赖升级失败：评估兼容性，必要时回滚并加固防护（WAF、限流）。
- 安全事件：启动应急响应，保留证据，完成复盘。

## 交付物

- 安全检查表与整改记录。
- 依赖漏洞报告与修复计划。
- 监控/报警配置、应急预案。
