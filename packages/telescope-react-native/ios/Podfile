#source 'https://github.com/CocoaPods/Specs.git'

def node_require(script)
    # Resolve react_native_pods.rb with node to allow for hoisting
    require Pod::Executable.execute_command('node', ['-p',
        "require.resolve(
            '#{script}',
            {paths: [process.argv[1]]},
        )", __dir__]).strip
end
node_require('react-native/scripts/react_native_pods.rb')
node_require('react-native-permissions/scripts/setup.rb')

platform :ios, min_ios_version_supported
prepare_react_native_project!

# ⬇️ uncomment wanted permissions
setup_permissions([
  # 'AppTrackingTransparency',
  'Bluetooth',
  # 'Calendars',
  # 'CalendarsWriteOnly',
  'Camera',
  # 'Contacts',
  # 'FaceID',
  # 'LocationAccuracy',
  # 'LocationAlways',
  # 'LocationWhenInUse',
  'MediaLibrary',
  # 'Microphone',
  # 'Motion',
  'Notifications',
  'PhotoLibrary',
  # 'PhotoLibraryAddOnly',
  # 'Reminders',
  # 'Siri',
  # 'SpeechRecognition',
  # 'StoreKit',
])

# platform :ios, '13.0'
use_frameworks!

#def fabric
#    pod 'Fabric'   #crash日志收集
#    pod 'Crashlytics'
#end

def library
#    pod 'KissXML'
#    pod 'KissXML/libxml_module'
    pod 'ICSMainFramework', :path => "./Library/ICSMainFramework/"
    pod 'MMWormhole'
    pod 'KeychainAccess'
    pod 'AsyncSwift'
    pod 'Alamofire', '~> 4.9.1'     #requests工具
    pod 'CryptoSwift' #AES加解密
    pod 'FCUUID'
    pod 'HandyJSON', '~> 5.0.2'
   # pod 'SQLite.swift', '~> 0.12.0'
end

def tunnel
    pod 'MMWormhole'
end

def socket
    pod 'CocoaAsyncSocket'
end


target "Telescope" do
  config = use_native_modules!

  use_react_native!(
    :path => config[:reactNativePath],
    # Enables Flipper.
    #
    # Note that if you have use_frameworks! enabled, Flipper will not work and
    # you should disable the next line.
    #:flipper_configuration => flipper_config,
    # An absolute path to your application root.
    :app_path => "#{Pod::Config.instance.installation_root}/..",
    :new_arch_enabled => true
  )

    pod 'HappyDNS', '1.0.4'
    pod 'ShadowsocksR/full', :path => "../../packages/react-native-shadowsocksr/ios"
    # 引入 TCP Ping 插件（工作区本地包）
    pod 'TcpPing', :path => "../../packages/react-native-tcp-ping/ios"
  pod 'SnapKit'
    pod 'Kingfisher'
#    pod 'GRDB.swift'
    pod 'AsyncSwift'
    pod 'SwiftColor'
#    pod 'ActiveLabel'   #富文本label
    pod 'Appirater'     #提醒用户评论打分
    pod 'MBProgressHUD'
    pod 'FJFKeyboardHelper'
    pod 'EFQRCode', '~> 5.1.0'
#    pod 'Eureka'     #talbeView 第三方库
    pod 'SwiftyStoreKit' #内购第三方库

    pod 'CallbackURLKit', :path => "./Library/CallbackURLKit"
    pod 'ICDMaterialActivityIndicatorView'
#    pod 'Reveal-iOS-SDK', '~> 1.6.2', :configurations => ['Debug']  #界面调试工具
    #pod 'ICSPullToRefresh', '~> 0.6'
#    pod 'ISO8601DateFormatter', '~> 0.8'
#    pod 'CocoaLumberjack/Swift', '~> 3.0.0'  #抓取crash日志上传
    pod 'PSOperations/Core'   #线程管理工具
    tunnel
    library
#    fabric
    socket

  post_install do |installer|
    # https://github.com/facebook/react-native/blob/main/packages/react-native/scripts/react_native_pods.rb#L197-L202
    react_native_post_install(
      installer,
      config[:reactNativePath],
      :mac_catalyst_enabled => false
    )
  end

end

target "PacketTunnel" do
  pod 'CocoaLumberjack/Swift'
  pod 'MMDB-Swift'
  pod 'Yaml'
#    pod 'NEKit'

    tunnel
    pod 'ShadowsocksR/full', :path => "../../packages/react-native-shadowsocksr/ios"
    socket
end

target "TodayWidget" do
  pod 'SnapKit'
    pod 'SwiftColor'
    library
    socket
end

target "ShadowLibrary" do
    library
end


# post_install do |installer|
#     installer.pods_project.targets.each do |target|
#         target.build_configurations.each do |config|
#             config.build_settings['IPHONEOS_DEPLOYMENT_TARGET'] = '13.0'
#             config.build_settings['ENABLE_BITCODE'] = 'NO'
# #            config.build_settings['SWIFT_ENABLE_BATCH_MODE'] = 'NO'
#             if target.name == "HelpShift"
#                 config.build_settings["OTHER_LDFLAGS"] = '$(inherited) "-ObjC"'
#             end
#         end
#     end
# end
